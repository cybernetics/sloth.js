<!DOCTYPE html>  <html> <head>   <title>sloth.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sloth.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><em>The lazy JavaScript iterator library.</em></p>

<p><code>sloth.js</code> is a JavaScript library for working with lazy iterators,
providing a way to create, compose and perform various other operations
on them --- forming a composable algebra of operations on iterators.</p>

<p><code>sloth.js</code> will be slower than conventional operations for short
operations (though sometimes outperforms native implementations for some
inexplicable reason), but where it shines is consuming large amounts of
data along a pipeline, e.g. combining <code>map</code>, <code>filter</code> and <code>foldl</code>
operations. This is because it doesn't allocate any space before actual
iteration.</p>

<p>Inspired by Python's <code>itertools</code> module, Haskell's lazy list facilities
and Jeremy Ashkenas's Underscore.js.</p>

<p><code>sloth.js</code> is freely distributable under the terms of the MIT license.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">sloth</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Slothification</h2>

<p><code>sloth.ify</code> a sequence, making it usable with <code>sloth.js</code> operations.
Slothification is an idempotent operation, meaning it can be used
on a slothified variable multiple times without any issue.</p>

<h3>Terminology</h3>

<h4>Lazy</h4>

<p>Lazy operations are run as the sequence is iterated, rather than
immediately when the function is called.</p>

<h4>Strict</h4>

<p>Strict operations run as soon as the function is called, allocating
space for it immediately. You may wish to run some strict operations
(e.g. <code>reverse</code> and <code>sort</code>) after forcing, as their in-place
native equivalents will be faster.</p>

<h4>Composable</h4>

<p>Composable operations can have successive operations invoked on
them, e.g. <code>map().map().filter().nub()</code>.</p>

<h4>Non-composable</h4>

<p>Non-composable operations are found at the end of a <code>sloth.ify</code>ed
chain, usually culminating in a result.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">xs</span><span class="p">.</span><span class="nx">slothified</span><span class="p">)</span> <span class="k">return</span> <span class="nx">xs</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterify</span><span class="p">(</span><span class="nx">xs</span><span class="p">));</span>
        <span class="p">},</span>

        <span class="nx">Slothified</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">Slothified</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iter</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">iter</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="nx">Slothified</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Mark the object as a <code>sloth.ify</code>ed.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">slothified</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Maps, filters and folds</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><code>map</code> applies a function across all elements of a sequence.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">map</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>filter</code> selects elements from a sequence that are <code>true</code>
when the predicate is applied to them.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">()));</span>
                        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>foldl</code> is an implementation of the left-fold operation,
also known as a left-reduce or inject.</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">foldl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">acc</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">acc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

                    <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">acc</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
                    <span class="p">});</span>
                    <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><code>foldr</code> is an implementation of the right-fold operation,
the reverse analog of <code>foldl</code> operation.</p>

<p>This operation may be slow due the fact the entire list must
first be reversed.</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">foldr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">acc</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">reverseIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
                        <span class="p">.</span><span class="nx">next</span><span class="p">;</span>

                    <span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">acc</span> <span class="o">=</span> <span class="nx">reverseIter</span><span class="p">();</span>

                    <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">reverseIter</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">acc</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">acc</span><span class="p">);</span>
                    <span class="p">});</span>
                    <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>Quantification</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>all</code> checks if all values in the sequence are truthy or
fulfill the predicate (universal quantification).</p>

<p>This is a partially strict non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">all</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><code>any</code> checks if any values in the sequence are truthy or
fulfill the predicate (existential quantification).</p>

<p>This is a partially strict non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">any</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Maxima and minima</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>max</code> returns the maximum value of the sequence using a
given comparison function.</p>

<p>If you're looking for the maximum of an array, it is much
more efficient to use <code>Math.max.apply(Math, array)</code> (up to
40x(!!) faster).</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">max</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">cmp</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">foldl</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">acc</span> <span class="o">:</span> <span class="nx">x</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>min</code> returns the minimum value of the sequence using a
given comparison function.</p>

<p>If you're looking for the minimum of an array, it is much
more efficient to use <code>Math.min.apply(Math, array)</code> (up to
40x(!!) faster).</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">min</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">cmp</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">foldl</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">acc</span> <span class="o">:</span> <span class="nx">x</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Taking and skipping</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><code>take</code> yields a sequence with only the first <em>n</em> elements of
the original sequence.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">take</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                        <span class="nx">n</span><span class="o">--</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>skip</code> yields a sequence without the first <em>n</em> elements of
the original sequence.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">skip</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">while</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                            <span class="nx">n</span><span class="o">--</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><code>takeWhile</code> yields a sequence with only the first
contiguous sequence of elements that fulfill the predicate.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">takeWhile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">ended</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="nx">ended</span> <span class="o">=</span> <span class="o">!</span><span class="nx">f</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">ended</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>skipWhile</code> yields a sequence without the first
contiguous sequence of elements that fulfill the predicate.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">skipWhile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">()));</span>

                    <span class="kd">var</span> <span class="nx">firstTaken</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">firstTaken</span><span class="p">)</span> <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="nx">firstTaken</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Set operations</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>union</code> yields a sequence with only the unique elements from
both sequences, using the given predicate for comparison.</p>

<p>This will drain the <code>ys</code> iterator.</p>

<p>This can be slow due to the use of <code>nub</code>.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">union</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">eq</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">ys</span><span class="p">).</span><span class="nx">nub</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>intersect</code> yields a sequence with only the unique elements
present in both sequences, using the given predicate for
comparison.</p>

<p>This will drain the <code>ys</code> iterator.</p>

<p>Yet again, this can be slow due to the use of <code>nub</code>.</p>

<p>This is a semi-strict composable operation, as it requires
the first iterator to be non-infinite.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">intersect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">eq</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nub</span><span class="p">(</span><span class="nx">f</span><span class="p">).</span><span class="nx">force</span><span class="p">();</span>
                    <span class="kd">var</span> <span class="nx">ysNubbed</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">ys</span><span class="p">).</span><span class="nx">nub</span><span class="p">().</span><span class="nx">next</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="nx">ysNubbed</span><span class="p">();</span>

                            <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">seen</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">seen</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><code>difference</code> yields a sequence with the elements of sequence
B removed from sequence A.</p>

<p>This will drain the <code>ys</code> iterator.</p>

<p>This does not return only unique elements, but the resulting
sequence can be <code>nub()</code>ed.</p>

<p>This is a semi-strict composable operation, as it requires
the second iterator to be non-infinite.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">difference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">eq</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">ys</span><span class="p">).</span><span class="nx">nub</span><span class="p">().</span><span class="nx">force</span><span class="p">();</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">skip</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                            <span class="nx">skip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                            <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">seen</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">seen</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="nx">skip</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                                    <span class="k">break</span><span class="p">;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">skip</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><code>symmetricDifference</code> yields a sequence of the elements
present in neither sequence.</p>

<p>This will drain the <code>ys</code> iterator.</p>

<p>This does not return only unique elements, but the resulting
sequence can be <code>nub()</code>ed.</p>

<p>This is a strict, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">symmetricDifference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">eq</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">xsArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">().</span><span class="nx">reverse</span><span class="p">();</span>
                    <span class="kd">var</span> <span class="nx">ysArray</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">ys</span><span class="p">).</span><span class="nx">force</span><span class="p">().</span><span class="nx">reverse</span><span class="p">();</span>

                    <span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">xsArray</span><span class="p">))</span>
                        <span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">ysArray</span><span class="p">),</span> <span class="nx">f</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">force</span><span class="p">();</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">skip</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">xsArray</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">value</span> <span class="o">=</span> <span class="nx">xsArray</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">ysArray</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">value</span> <span class="o">=</span> <span class="nx">ysArray</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                            <span class="p">}</span>

                            <span class="nx">skip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                            <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">seen</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">seen</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="nx">skip</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                                    <span class="k">break</span><span class="p">;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">skip</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>Sequence utilities</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><code>each</code> acts as a for-each loop and iterates through all
elements of the sequence, applying the given function to
each.</p>

<p><code>sloth.StopIteration</code> can be thrown at any time to break out
of the loop.</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">each</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">f</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">i</span><span class="o">++</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><code>concat</code> joins two sequences to each other, end-to-end.</p>

<p>This will drain the <code>ys</code> iterator.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">concat</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">xsEnd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">ysIter</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">ys</span><span class="p">).</span><span class="nx">next</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">xsEnd</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">try</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                                <span class="nx">xsEnd</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                                <span class="k">return</span> <span class="nx">ysIter</span><span class="p">();</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="k">if</span><span class="p">(</span><span class="nx">xsEnd</span><span class="p">)</span> <span class="k">return</span> <span class="nx">ysIter</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p><code>product</code> yields the Cartesian product of a series of
sequences.</p>

<p>This will completely drain all iterators.</p>

<p>This is a strict, composable operation (until someone
figures out a lazy version).</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">product</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">arrays</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
                    <span class="nx">arrays</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arrays</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">arrays</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">arrays</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">force</span><span class="p">();</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>The following code is downright disgusting, so
annotations will be provided in the form of Haskell
code.</p>

<pre><code>product arrays = foldl f [[]] arrays
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">arrays</span><span class="p">)).</span><span class="nx">foldl</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">accs</span><span class="p">,</span> <span class="nx">xs</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <pre><code>    where f accs xs = foldl (g accs) [] xs
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">xs</span><span class="p">)).</span><span class="nx">foldl</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <pre><code>          g accs acc x = acc ++ (zs x accs)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">acc</span><span class="p">)).</span><span class="nx">concat</span><span class="p">(</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <pre><code>          zs x = map (h x) accs
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                                <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">accs</span><span class="p">)).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ys</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <pre><code>          h x ys = ys ++ [x]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">ys</span><span class="p">))</span>
                                        <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">([</span><span class="nx">x</span><span class="p">]))</span>
                                        <span class="p">.</span><span class="nx">force</span><span class="p">();</span>
                                <span class="p">}).</span><span class="nx">force</span><span class="p">())</span>
                            <span class="p">).</span><span class="nx">force</span><span class="p">();</span>
                        <span class="p">},</span> <span class="p">[]);</span>
                    <span class="p">},</span> <span class="p">[[]])));</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><code>cycle</code> loops a list around itself infinitely.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">cycle</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">xs</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="kd">var</span> <span class="nx">xsIter</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>

                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">xsIter</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span> <span class="o">:</span> <span class="nx">xsIter</span><span class="p">)();</span>
                        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                            <span class="nx">xsIter</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">xs</span><span class="p">);</span>
                            <span class="k">return</span> <span class="nx">xsIter</span><span class="p">();</span>
                        <span class="p">}</span>

                        <span class="k">if</span><span class="p">(</span><span class="nx">xsIter</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><code>nub</code> removes duplicate elements from the sequence using
the given predicate for comparison.</p>

<p>This is up to 10x slower than Underscore.js's <code>uniq</code>, but is
more flexible in its operation.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">nub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">eq</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="p">[];</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">skip</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                            <span class="nx">skip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                            <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">seen</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">seen</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">value</span><span class="p">))</span> <span class="nx">skip</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">skip</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                            <span class="nx">seen</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                            <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><code>enumerate</code> takes each element and places it in an array
with the index as the first element.</p>

<p>This is a lazy, composable operaton.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">enumerate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">,</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">()];</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><code>reverse</code> reverses the sequence.</p>

<p>This is a strict, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">reverse</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">();</span>
                    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="o">--</span><span class="nx">n</span><span class="p">];</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>sort</code> sorts the sequence using a comparison function.</p>

<p>This is a strict, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">sort</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">cmp</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">();</span>
                    <span class="nx">array</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">array</span><span class="p">));</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><code>tee</code> splits the sequence into two independent sequence
iterators.</p>

<p>This may allocate a large amount of additional storage, and
<em>will</em> exhibit unbounded growth on infinite sequences.</p>

<p>The original iterator should not be used.</p>

<p>This is a lazy, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">tee</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="kd">var</span> <span class="nx">right</span> <span class="o">=</span> <span class="p">[];</span>

                    <span class="kd">var</span> <span class="nx">makeIter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>

                            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">value</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

                                <span class="nx">left</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                                <span class="nx">right</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="k">return</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                        <span class="p">};</span>
                    <span class="p">};</span>

                    <span class="k">return</span> <span class="p">[</span><span class="nx">makeIter</span><span class="p">(</span><span class="nx">left</span><span class="p">),</span> <span class="nx">makeIter</span><span class="p">(</span><span class="nx">right</span><span class="p">)];</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>zip</code> takes the sequences passed to it and yields a new
sequence taking an element from each element and placing it
into an array. The length of the resulting sequence is the
length of the shortest sequence passed in.</p>

<p>This is somewhat more useful with JavaScript 1.7
destructuring assignment.</p>

<p>This is a lazy, composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">zip</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">iters</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
                    <span class="nx">iters</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">iters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">iters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">ify</span><span class="p">(</span><span class="nx">iters</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">next</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="k">new</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">Slothified</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[];</span>

                        <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">iters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">iters</span><span class="p">[</span><span class="nx">i</span><span class="p">]());</span>
                        <span class="p">}</span>

                        <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>force</code> gets all the elements from the iterator and places
them into an array.</p>

<p>This is a strict, non-composable operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">force</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>

                    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h2>Advanced features</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><code>__iterator__</code> implements the iterator protocol for
JavaScript 1.7.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">__iterator__</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="nx">Slothified</span><span class="p">;</span>
        <span class="p">})(),</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h2>Iterators</h2>

<p>A lazy iterator in <code>sloth.js</code> is defined as a function (usually a
closure) which can be repeatedly invoked to yield successive values
of a sequence, until the appropriate exception,
<code>sloth.StopIteration</code>, is thrown to indicate the end of the
sequence.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><code>iterify</code> creates an low-level iterator for various common data
types.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xs</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Check if the object is a function (and therefore can be used as
an iterator).</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="nx">xs</span> <span class="o">&amp;&amp;</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">&amp;&amp;</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">call</span> <span class="o">&amp;&amp;</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">apply</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">xs</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Check if the object is a generator (JavaScript 1.7 only).</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">next</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterGenerator</span><span class="p">(</span><span class="nx">xs</span><span class="p">);</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Check if the object is a <code>String</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">xs</span><span class="p">.</span><span class="nx">substring</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterString</span><span class="p">(</span><span class="nx">xs</span><span class="p">);</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Check if the object is an <code>Array</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xs</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;[object Array]&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">xs</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterObject</span><span class="p">(</span><span class="nx">xs</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Create an iterator for an array. Note that this is the low-level
iterator and needs to be <code>new sloth.Slothified</code>ed for useful things.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];</span>
            <span class="p">};</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Create an iterator for a string.  Note that this is the low-level
iterator and needs to be <code>new sloth.Slothified</code>ed for useful things.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterString</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Create an iterator for an object which yields pairs of keys and
values. This will immediately read in the object and generate a
list of its keys and values and, as such, won't reflect any changes
to the object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">k</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
                <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">k</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">k</span><span class="p">]]);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">iterArray</span><span class="p">(</span><span class="nx">items</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Create an iterator for a generator (JavaScript 1.7 only).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterGenerator</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">generator</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">generator</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
            <span class="p">};</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Create an iterator for a range. Comes in three variants:</p>

<ul>
<li><p>If only a single argument <code>a</code> is provided, an iterator for a range
from 0 to <code>a - 1</code> by a step of 1.</p></li>
<li><p>If the third argument, <code>step</code>, is left unspecified, the step
defaults to 1.</p></li>
<li><p>If all three arguments are specified, a range from <code>a</code> to <code>b - 1</code>
is created by a step of <code>step</code>.</p></li>
</ul>

<p>Note that the end of the range does not include <code>b</code> --- this is
influenced by Python's <code>range</code> function.</p>

<p>Also note that this is the low-level iterator and needs to be
<code>new sloth.Slothified</code>ed for useful things.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterRange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
                <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">step</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">a</span> <span class="o">&gt;=</span> <span class="nx">b</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">sloth</span><span class="p">.</span><span class="nx">StopIteration</span><span class="p">;</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+=</span> <span class="nx">step</span><span class="p">)</span> <span class="o">-</span> <span class="nx">step</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <h3>StopIteration</h3>

<p><code>StopIteration</code> is an object which is thrown to indicate that the
iterator has no more data left to yield, i.e. an end-of-stream
situation.</p>

<p>A common example of this reaching the end of an array in a
traditional <code>for</code> loop.</p>

<p>Some JavaScript engines (presently SpiderMonkey) support
<code>StopIteration</code> exceptions.</p>

<p><code>StopIteration</code> instances must <em>not</em> be instantiated --- it is a
singleton exception object which is designed to be thrown as is.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">StopIteration</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">StopIteration</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                       <span class="nx">StopIteration</span> <span class="o">:</span>
                       <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h2>Utility functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>A function where, given a value, returns the value (a la Haskell).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">id</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>The default comparison function, combining both lexicographic and
numerical semantics.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">cmp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span>
                   <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span>
                   <span class="mi">0</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>The default equality function, which returns the strict equality of
two values.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">eq</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h2>Finale</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Export <code>sloth.js</code> appropriately for Node.js and the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">sloth</span> <span class="o">=</span> <span class="nx">sloth</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 